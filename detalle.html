<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Detalle de Licitación | LICITADOR PE</title>
    <meta name="description" content="Detalle completo de licitación SEACE para INPROMETAL SAC." />
    <script src="data.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#135bec', 50: '#eff4ff', 100: '#dbeafe', 600: '#2563eb', 700: '#1d4ed8' },
                        background: { light: '#f8fafc', dark: '#0f172a' },
                        surface: { light: '#ffffff', dark: '#1e293b' }
                    },
                    fontFamily: { sans: ['Public Sans', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: "Public Sans", sans-serif;
        }

        .timeline-line {
            position: absolute;
            left: 9px;
            top: 20px;
            bottom: -28px;
            width: 2px;
            background: #e2e8f0;
        }

        .timeline-line.done {
            background: #22c55e;
        }

        .timeline-line.active {
            background: linear-gradient(to bottom, #22c55e, #e2e8f0);
        }

        @keyframes pulse-ring {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(19, 91, 236, .4);
            }

            50% {
                box-shadow: 0 0 0 6px rgba(19, 91, 236, 0);
            }
        }

        .pulse-active {
            animation: pulse-ring 2s ease-in-out infinite;
        }
    </style>
</head>

<body
    class="bg-background-light text-slate-900 min-h-screen flex flex-col font-sans selection:bg-primary selection:text-white">

    <!-- ===== TOP NAVBAR ===== -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center gap-8">
                    <a href="index.html" class="flex items-center gap-2.5">
                        <span class="material-symbols-outlined text-3xl text-primary">gavel</span>
                        <span class="text-lg font-black tracking-tight text-slate-900">LICITADOR <span
                                class="text-primary">PE</span></span>
                    </a>
                    <nav class="hidden md:flex items-center gap-6">
                        <a href="index.html"
                            class="text-sm font-medium text-slate-600 hover:text-primary transition-colors">Buscador</a>
                        <a href="index.html" class="text-sm font-medium text-primary font-bold">Licitaciones</a>
                    </nav>
                </div>
                <!-- Actions -->
                <div class="flex items-center gap-3">
                    <a href="index.html"
                        class="hidden sm:flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-200 text-slate-600 hover:border-primary hover:text-primary text-sm font-semibold transition-all">
                        <span class="material-symbols-outlined text-lg">arrow_back</span>
                        Volver al Buscador
                    </a>
                    <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary text-xl">domain</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-24 lg:pb-8">

        <!-- Breadcrumbs -->
        <nav class="flex mb-6 text-sm text-slate-500">
            <a href="index.html" class="hover:text-primary transition-colors">Inicio</a>
            <span class="mx-2 text-slate-300">/</span>
            <a href="index.html" class="hover:text-primary transition-colors">Búsqueda</a>
            <span class="mx-2 text-slate-300">/</span>
            <span class="text-slate-900 font-semibold">Detalle de Licitación</span>
        </nav>

        <!-- ===== HERO HEADER ===== -->
        <div class="mb-8">
            <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6">
                <div class="flex-1">
                    <div class="flex flex-wrap items-center gap-3 mb-3">
                        <span id="statusBadge"
                            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700">
                            Abierta
                        </span>
                        <span class="text-slate-400 text-sm font-mono" id="topTenderId">---</span>
                        <span id="matchBadge"
                            class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold bg-primary/10 text-primary">
                            <span class="material-symbols-outlined text-sm">target</span>
                            <span id="matchPct">0%</span> Match INPROMETAL
                        </span>
                    </div>
                    <h1 id="tenderTitle"
                        class="text-3xl md:text-4xl font-black text-slate-900 tracking-tight leading-tight mb-3">
                        Cargando...</h1>
                    <p class="text-base text-slate-500">
                        <span id="tenderAgency" class="font-bold text-slate-700">---</span>
                        <span class="mx-2 text-slate-300">•</span>
                        <span id="tenderLocation">---</span>
                        <span class="mx-2 text-slate-300">•</span>
                        <span>Publicado: <span id="tenderPubDate" class="font-medium text-slate-700">---</span></span>
                    </p>
                </div>
                <!-- Action Buttons -->
                <div class="flex items-center gap-3 shrink-0">
                    <button id="followBtn" onclick="toggleFollow()"
                        class="flex items-center justify-center gap-2 px-4 py-2.5 border border-slate-300 rounded-lg text-slate-700 font-semibold hover:bg-slate-50 hover:border-primary hover:text-primary transition-all text-sm">
                        <span class="material-symbols-outlined text-xl">bookmark_border</span>
                        <span class="hidden sm:inline">Seguir</span>
                    </button>
                    <button onclick="copiarEnlace()"
                        class="flex items-center justify-center gap-2 px-4 py-2.5 border border-slate-300 rounded-lg text-slate-700 font-semibold hover:bg-slate-50 transition-all text-sm">
                        <span class="material-symbols-outlined text-xl">share</span>
                        <span class="hidden sm:inline">Compartir</span>
                    </button>
                    <button onclick="enviarCRM()"
                        class="flex items-center justify-center gap-2 px-5 py-2.5 bg-primary hover:bg-primary-700 text-white rounded-lg font-bold shadow-lg shadow-primary/25 transition-all text-sm">
                        <span>Enviar a CRM</span>
                        <span class="material-symbols-outlined text-xl">send</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== SPLIT LAYOUT ===== -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- ========== LEFT COLUMN ========== -->
            <div class="lg:col-span-7 flex flex-col gap-6">

                <!-- Metric Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Budget Card -->
                    <div
                        class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hover:border-primary/40 transition-colors flex flex-col justify-between group">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-green-50 rounded-xl text-green-600">
                                <span class="material-symbols-outlined">payments</span>
                            </div>
                            <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Referencial</span>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-slate-500 mb-1">Valor del Contrato</p>
                            <p id="tenderBudget" class="text-3xl font-black text-slate-900 tracking-tight">S/ 0</p>
                        </div>
                    </div>
                    <!-- Deadline Card -->
                    <div id="deadlineCard"
                        class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hover:border-orange-300 transition-colors flex flex-col justify-between">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2 bg-orange-50 rounded-xl text-orange-600">
                                <span class="material-symbols-outlined">hourglass_top</span>
                            </div>
                            <span id="urgencyBadge"
                                class="text-xs font-bold text-orange-600 bg-orange-100 px-2 py-1 rounded-full hidden">⚡
                                Alta Prioridad</span>
                        </div>
                        <div>
                            <p class="text-xs font-semibold text-slate-500 mb-1">Fecha Límite</p>
                            <p id="daysLeft" class="text-3xl font-black text-slate-900 tracking-tight">---</p>
                            <p id="deadlineFull" class="text-xs text-slate-500 mt-1">---</p>
                        </div>
                    </div>
                </div>

                <!-- Cronograma -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-base font-black text-slate-900 mb-6 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">calendar_month</span> Cronograma
                    </h2>
                    <div id="timelineContainer" class="relative pl-6 space-y-8">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Tags -->
                <div id="tagsRow" class="flex flex-wrap gap-3">
                    <!-- Injected by JS -->
                </div>

                <!-- Description -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="text-base font-black text-slate-900 mb-3">Descripción General</h3>
                    <p id="tenderDescription" class="text-slate-600 text-sm leading-relaxed">Cargando...</p>
                    <a id="drawerFullLink" href="#"
                        class="inline-flex items-center gap-1 text-primary hover:text-primary-700 text-sm font-bold mt-4 transition-colors">
                        Ver en portal SEACE <span class="material-symbols-outlined text-base">open_in_new</span>
                    </a>
                </div>

                <!-- Licitaciones Similares -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="text-base font-black text-slate-900 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined text-slate-400">layers</span>
                        Oportunidades Similares
                    </h3>
                    <div id="similarContainer" class="space-y-3">
                        <div class="animate-pulse h-16 bg-slate-100 rounded-xl"></div>
                        <div class="animate-pulse h-16 bg-slate-100 rounded-xl"></div>
                    </div>
                </div>
            </div>

            <!-- ========== RIGHT COLUMN (Sticky) ========== -->
            <div class="lg:col-span-5">
                <div class="sticky top-24 space-y-5">

                    <!-- Semáforo Financiero -->
                    <div id="semaforoCard"
                        class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden hidden">
                        <div class="bg-slate-50 px-5 py-4 border-b border-slate-100 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">traffic</span>
                            <h3 class="text-sm font-black text-slate-900">Viabilidad Financiera</h3>
                        </div>
                        <div class="p-5">
                            <div class="flex items-center gap-3">
                                <span id="semaforoIcon" class="material-symbols-outlined text-2xl">circle</span>
                                <p id="semaforoText" class="text-sm font-bold text-slate-700">---</p>
                            </div>
                        </div>
                    </div>

                    <!-- Checklist de Requisitos -->
                    <div
                        class="bg-white rounded-2xl shadow-lg shadow-slate-200/50 border border-slate-200 overflow-hidden">
                        <div class="bg-slate-50 px-6 py-4 border-b border-slate-100">
                            <h3 class="text-base font-black text-slate-900 flex items-center gap-2">
                                <span class="material-symbols-outlined text-primary">fact_check</span>
                                Checklist de Requisitos
                            </h3>
                            <p class="text-xs text-slate-500 mt-1">Valida si INPROMETAL cumple antes de postular.</p>
                        </div>
                        <div class="p-6 space-y-5">
                            <!-- Standard Requirements (always shown) -->
                            <div>
                                <h4
                                    class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-base">gavel</span> Habilitantes
                                    Generales
                                </h4>
                                <ul class="space-y-3">
                                    <li class="flex items-center gap-3 text-sm text-slate-700">
                                        <div
                                            class="w-5 h-5 rounded-full bg-green-100 border-2 border-green-400 flex items-center justify-center shrink-0">
                                            <span
                                                class="material-symbols-outlined text-[12px] text-green-600">check</span>
                                        </div>
                                        RNP Vigente (Registro Nacional de Proveedores)
                                    </li>
                                    <li class="flex items-center gap-3 text-sm text-slate-700">
                                        <div
                                            class="w-5 h-5 rounded-full border-2 border-slate-300 flex items-center justify-center shrink-0">
                                            <span
                                                class="material-symbols-outlined text-[12px] text-slate-300">check</span>
                                        </div>
                                        SUNAT al día (Sin deudas coactivas)
                                    </li>
                                    <li class="flex items-center gap-3 text-sm text-slate-700">
                                        <div
                                            class="w-5 h-5 rounded-full border-2 border-slate-300 flex items-center justify-center shrink-0">
                                            <span
                                                class="material-symbols-outlined text-[12px] text-slate-300">check</span>
                                        </div>
                                        Vigencia de Poder del Representante Legal
                                    </li>
                                </ul>
                            </div>
                            <hr class="border-slate-100" />
                            <!-- Technical Requirements from data -->
                            <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                                <h4
                                    class="text-[10px] font-black text-red-600 uppercase tracking-widest mb-3 flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-base">warning</span> Requisitos Técnicos
                                    Obligatorios
                                </h4>
                                <ul id="tenderRequirements" class="space-y-3">
                                    <!-- Injected by JS -->
                                </ul>
                            </div>
                            <hr class="border-slate-100" />
                            <!-- Financial / Fianza -->
                            <div>
                                <h4
                                    class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-base">attach_money</span> Garantías
                                </h4>
                                <ul class="space-y-3">
                                    <li id="fianzaItem" class="flex items-start gap-3 text-sm text-slate-700">
                                        <div
                                            class="w-5 h-5 rounded-full border-2 border-slate-300 flex items-center justify-center shrink-0 mt-0.5">
                                            <span
                                                class="material-symbols-outlined text-[12px] text-slate-300">check</span>
                                        </div>
                                        <span>Carta Fianza (10% del valor del contrato)</span>
                                    </li>
                                    <li class="flex items-start gap-3 text-sm text-slate-700">
                                        <div
                                            class="w-5 h-5 rounded-full border-2 border-slate-300 flex items-center justify-center shrink-0 mt-0.5">
                                            <span
                                                class="material-symbols-outlined text-[12px] text-slate-300">check</span>
                                        </div>
                                        <span>Seguro Complementario de Trabajo de Riesgo</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- CTA -->
                        <div class="bg-slate-50 p-5 border-t border-slate-100">
                            <button onclick="enviarCRM()"
                                class="w-full flex items-center justify-center gap-2 py-3 bg-primary hover:bg-primary-700 text-white rounded-xl font-black text-sm shadow-lg shadow-primary/25 transition-all mb-3">
                                <span>Enviar a CRM / Pipeline</span>
                                <span class="material-symbols-outlined text-xl">send</span>
                            </button>
                            <p class="text-[10px] text-center text-slate-400">
                                Los datos se registran en tu Pipeline comercial interno.
                            </p>
                        </div>
                    </div>

                    <!-- Calculadora de Rentabilidad (Bid/No-Bid) -->
                    <div class="bg-slate-900 rounded-2xl shadow-xl border border-slate-800 overflow-hidden">
                        <div
                            class="bg-slate-800/50 px-6 py-4 border-b border-slate-700 flex items-center justify-between">
                            <h3 class="text-sm font-black text-white flex items-center gap-2">
                                <span class="material-symbols-outlined text-amber-400">calculate</span>
                                Evaluación Bid / No-Bid
                            </h3>
                            <span
                                class="text-[10px] font-black bg-amber-400/10 text-amber-400 px-2 py-0.5 rounded-full uppercase tracking-widest">Calculadora</span>
                        </div>
                        <div class="p-6 space-y-4">
                            <!-- Inputs -->
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <label class="text-xs text-slate-400 font-medium tracking-wide">Costo
                                        Materiales</label>
                                    <div class="relative w-32">
                                        <span
                                            class="absolute left-2.5 top-1.5 text-[10px] text-slate-500 font-bold">S/</span>
                                        <input type="number" id="calcMaterials" value="0" oninput="updateProfitCalc()"
                                            class="w-full pl-7 pr-2 py-1.5 bg-slate-800 border-slate-700 rounded-lg text-xs text-white focus:ring-1 focus:ring-amber-400 transition-all text-right tabular-nums">
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-xs text-slate-400 font-medium tracking-wide">Costo Mano
                                        Obra</label>
                                    <div class="relative w-32">
                                        <span
                                            class="absolute left-2.5 top-1.5 text-[10px] text-slate-500 font-bold">S/</span>
                                        <input type="number" id="calcLabor" value="0" oninput="updateProfitCalc()"
                                            class="w-full pl-7 pr-2 py-1.5 bg-slate-800 border-slate-700 rounded-lg text-xs text-white focus:ring-1 focus:ring-amber-400 transition-all text-right tabular-nums">
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-xs text-slate-400 font-medium tracking-wide">Gtos. Generales
                                        (20%)</label>
                                    <div class="relative w-32">
                                        <span
                                            class="absolute left-2.5 top-1.5 text-[10px] text-slate-500 font-bold">S/</span>
                                        <input type="number" id="calcGeneral" value="0" oninput="updateProfitCalc()"
                                            class="w-full pl-7 pr-2 py-1.5 bg-slate-800/30 border-slate-700 rounded-lg text-xs text-slate-400 cursor-not-allowed text-right tabular-nums"
                                            readonly>
                                    </div>
                                </div>
                            </div>

                            <hr class="border-slate-800">

                            <!-- Visual Results -->
                            <div class="bg-slate-800/30 p-4 rounded-xl space-y-3">
                                <div class="flex justify-between items-end">
                                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Margen
                                        Bruto est.</span>
                                    <span id="calcProfitPct"
                                        class="text-xl font-black text-green-400 tabular-nums">100%</span>
                                </div>
                                <div class="w-full h-1.5 bg-slate-700 rounded-full overflow-hidden">
                                    <div id="calcProfitBar" class="h-full bg-green-400 transition-all"
                                        style="width: 100%"></div>
                                </div>
                                <p id="calcTotalCostText" class="text-[10px] text-slate-400 text-center italic">Costo
                                    Total: S/ 0</p>
                            </div>

                            <!-- Bid/No-Bid Verdict -->
                            <div id="bidVerdict"
                                class="p-3 rounded-lg text-center text-xs font-black uppercase tracking-wider bg-green-500/10 text-green-400 border border-green-500/20">
                                Altamente Rentable (Bid)
                            </div>
                        </div>
                    </div>

                    <!-- Entity Profile -->
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                        <h4 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Perfil del
                            Comprador</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-500 flex items-center gap-1.5"><span
                                        class="material-symbols-outlined text-base text-slate-400">trending_up</span>Frecuencia</span>
                                <span id="entityFreq" class="font-bold text-slate-800">--</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-500 flex items-center gap-1.5"><span
                                        class="material-symbols-outlined text-base text-slate-400">history</span>Historial
                                    (12m)</span>
                                <span id="entityHistory" class="font-bold text-slate-800">--</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-500 flex items-center gap-1.5"><span
                                        class="material-symbols-outlined text-base text-slate-400">category</span>Sector</span>
                                <span class="font-bold text-primary">Infraestructura</span>
                            </div>
                        </div>
                    </div>

                    <!-- Help Card -->
                    <div class="bg-blue-50 p-5 rounded-2xl border border-blue-100 flex gap-4 items-start">
                        <div class="p-2 bg-white rounded-full shadow-sm text-primary shrink-0">
                            <span class="material-symbols-outlined">support_agent</span>
                        </div>
                        <div>
                            <p class="text-sm font-black text-slate-900 mb-1">¿Necesitas revisar las bases?</p>
                            <p class="text-xs text-slate-600 mb-2">Accede directamente al portal SEACE para descargar el
                                expediente completo.</p>
                            <a id="seaceLink" href="https://www.seace.gob.pe" target="_blank"
                                class="text-xs font-bold text-primary hover:underline">
                                Ir al portal SEACE →
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <!-- ===== MOBILE FLOATING ACTION BAR ===== -->
    <div
        class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4 lg:hidden z-40 flex gap-3 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.08)]">
        <button id="followBtnMobile" onclick="toggleFollow()"
            class="flex-1 py-3 bg-slate-100 text-slate-900 rounded-xl font-bold border border-slate-200 flex items-center justify-center gap-2 text-sm">
            <span class="material-symbols-outlined text-lg">bookmark_border</span>
            Seguir
        </button>
        <button onclick="enviarCRM()"
            class="flex-[2] py-3 bg-primary text-white rounded-xl font-black shadow-lg shadow-primary/25 flex items-center justify-center gap-2 text-sm">
            <span>Enviar a CRM</span>
            <span class="material-symbols-outlined">send</span>
        </button>
    </div>

    <script src="detalle.js"></script>
</body>

</html>