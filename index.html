<!DOCTYPE html>

<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Buscador de Licitaciones Inteligente</title>
    <script src="data.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="tailwind.config.js"></script>
    <style>
        /* Agregando estilos para scroll que venían del de detalles */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Skeleton Loader */
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .skeleton {
            background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        /* Responsive: Card view en móvil */
        @media (max-width: 768px) {
            .desktop-table {
                display: none !important;
            }

            .mobile-cards {
                display: block !important;
            }
        }

        @media (min-width: 769px) {
            .mobile-cards {
                display: none !important;
            }
        }

        /* Enterprise: Tabular Numbers */
        .tabular-nums {
            font-variant-numeric: tabular-nums;
        }

        /* Indicador de "Visto" */
        .row-visited {
            background-color: #f8fafc !important;
        }

        .row-visited td:first-child span:first-child {
            color: #94a3b8 !important;
        }

        /* Action Menu Dropdown */
        .action-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            z-index: 30;
        }

        .action-trigger:focus-within .action-menu {
            display: block;
        }

        /* Sticky first column on mobile scroll */
        @media (max-width: 1024px) {
            .sticky-col {
                position: sticky;
                left: 0;
                z-index: 5;
                background: inherit;
            }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            pointer-events: auto;
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: toastIn .3s ease-out, toastOut .3s ease-in 4s forwards;
            box-shadow: 0 8px 30px rgba(0, 0, 0, .12);
            max-width: 380px;
        }

        .toast-error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .toast-success {
            background: #f0fdf4;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        .toast-warning {
            background: #fffbeb;
            color: #d97706;
            border: 1px solid #fde68a;
        }

        .toast-info {
            background: #eff6ff;
            color: #2563eb;
            border: 1px solid #bfdbfe;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(80px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes toastOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        /* Semáforo Financiero */
        .semaforo-verde {
            color: #16a34a;
        }

        .semaforo-amarillo {
            color: #d97706;
        }

        .semaforo-rojo {
            color: #dc2626;
        }
    </style>
</head>

<body
    class="bg-[#0f172a] text-slate-100 font-display antialiased min-h-screen flex flex-col md:flex-row overflow-hidden">
    <!-- Sidebar -->
    <aside
        class="w-full md:w-64 bg-[#1a2234] border-r border-slate-800 flex-shrink-0 flex flex-col h-screen sticky top-0">
        <!-- Brand -->
        <div class="h-16 flex items-center px-6 border-b border-slate-100 dark:border-slate-800">
            <div class="flex items-center gap-2 text-primary">
                <span class="material-symbols-outlined text-3xl">gavel</span>
                <span class="text-lg font-bold tracking-tight text-slate-900 dark:text-white">LICITADOR <span
                        class="text-primary">PE</span></span>
            </div>
        </div>
        <!-- User Profile (dinámico desde perfil) -->
        <div class="p-4 border-b border-slate-100 dark:border-slate-800">
            <div class="flex items-center gap-3 cursor-pointer" onclick="openOnboarding()">
                <div class="bg-primary/20 h-10 w-10 rounded-full flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary text-lg">business</span>
                </div>
                <div class="flex flex-col flex-1 min-w-0">
                    <h3 id="sidebarCompanyName" class="text-sm font-bold text-slate-900 dark:text-white truncate">Mi
                        Empresa</h3>
                    <p id="sidebarPlan" class="text-xs text-primary font-semibold">Plan Gratis • Configurar</p>
                </div>
                <span class="material-symbols-outlined text-slate-400 text-sm">edit</span>
            </div>
        </div>
        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
            <a id="navDashboard"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-primary transition-colors group cursor-pointer"
                onclick="switchView('dashboard')">
                <span class="material-symbols-outlined group-hover:text-primary">dashboard</span>
                <span class="text-sm font-medium">Dashboard</span>
            </a>
            <a id="navSearch"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary font-medium transition-colors cursor-pointer"
                onclick="switchView('search')">
                <span class="material-symbols-outlined fill-1">search</span>
                <span class="text-sm">Buscador</span>
            </a>
            <a id="navPipeline"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-primary transition-colors group cursor-pointer"
                onclick="switchView('pipeline')">
                <span class="material-symbols-outlined group-hover:text-primary">view_kanban</span>
                <span class="text-sm font-medium">Pipeline</span>
                <span id="badgePipeline"
                    class="bg-primary/10 text-primary text-xs font-bold px-2 py-0.5 rounded-full ml-auto">0</span>
            </a>
            <a id="navAnalytics"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-primary transition-colors group cursor-pointer"
                onclick="switchView('analytics')">
                <span class="material-symbols-outlined group-hover:text-primary">analytics</span>
                <span class="text-sm font-medium">Analíticas</span>
            </a>
            <!-- Smart Alerts Section -->
            <div class="pt-6 pb-2 px-3">
                <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Alertas Inteligentes</p>
            </div>
            <a id="alertNuevas"
                class="flex items-center justify-between px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 group transition-colors cursor-pointer"
                onclick="filterByAlert('nuevas')">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-orange-500">notifications_active</span>
                    <span class="text-sm font-medium">Nuevas Oportunidades</span>
                </div>
                <span id="badgeNuevas"
                    class="bg-orange-100 text-orange-600 text-xs font-bold px-2 py-0.5 rounded-full">0</span>
            </a>
            <a id="alertCierre"
                class="flex items-center justify-between px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 group transition-colors cursor-pointer"
                onclick="filterByAlert('cierre')">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-red-500">warning</span>
                    <span class="text-sm font-medium">Cierre Próximo</span>
                </div>
                <span id="badgeCierre"
                    class="bg-red-100 text-red-600 text-xs font-bold px-2 py-0.5 rounded-full">0</span>
            </a>
            <!-- Saved Searches Section -->
            <div class="pt-6 pb-2 px-3">
                <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Búsquedas Guardadas</p>
            </div>
            <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
                href="#">
                <span class="material-symbols-outlined text-slate-400 text-[20px]">bookmark</span>
                <span class="text-sm">Puentes Metálicos</span>
            </a>
            <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
                href="#">
                <span class="material-symbols-outlined text-slate-400 text-[20px]">bookmark</span>
                <span class="text-sm">Estructuras Lima</span>
            </a>
        </nav>
        <!-- Sidebar Footer -->
        <div class="p-4 border-t border-slate-100 dark:border-slate-800 space-y-1">
            <button onclick="openPricing()"
                class="w-full flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/5 text-primary hover:bg-primary/10 transition-colors">
                <span class="material-symbols-outlined text-sm">diamond</span>
                <span class="text-sm font-bold">Ver Planes</span>
            </button>
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors cursor-pointer"
                onclick="openOnboarding()">
                <span class="material-symbols-outlined">settings</span>
                <span class="text-sm font-medium">Configurar Perfil</span>
            </a>
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors"
                href="#">
                <span class="material-symbols-outlined">logout</span>
                <span class="text-sm font-medium">Cerrar Sesión</span>
            </a>
        </div>

    </aside>
    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden bg-[#0f172a] relative">
        <!-- Gradient Background Decor -->
        <div
            class="absolute top-0 left-0 right-0 h-64 bg-gradient-to-b from-primary/5 to-transparent pointer-events-none">
        </div>
        <!-- Header Area -->
        <header class="flex-shrink-0 px-8 py-6 z-10">
            <!-- Secciones de Navegación -->
            <div id="searchView" class="view-section">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h1 class="text-3xl font-black text-white tracking-tight mb-2" style="color:#f97316;">Buscador
                            de Licitaciones</h1>
                        <p id="searchSubtitle" style="color:#94a3b8;">Encuentra oportunidades de gobierno relevantes
                            para INPROMETAL.</p>
                    </div>
                </div>
                <!-- Search Bar Container -->
                <div
                    class="bg-white dark:bg-[#1e293b] rounded-xl shadow-lg shadow-slate-200/50 dark:shadow-black/20 border border-slate-100 dark:border-slate-700 overflow-hidden">
                    <!-- Row 1: Search Input + Button -->
                    <div class="flex items-center gap-2 p-2">
                        <div class="flex-1 relative flex items-center">
                            <span class="material-symbols-outlined absolute left-4 text-slate-400">search</span>
                            <input id="searchInput"
                                class="w-full pl-12 pr-4 py-3 bg-transparent border-none focus:ring-0 text-slate-900 dark:text-white placeholder-slate-400 text-base"
                                placeholder="Ej: Estructuras metálicas, fierro negro, mantenimiento..." type="text"
                                value="" />
                        </div>
                        <button id="searchBtn"
                            class="bg-primary hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-medium shadow-md shadow-blue-500/20 transition-all flex items-center justify-center gap-2 shrink-0">
                            Buscar
                        </button>
                    </div>
                    <!-- Row 2: Filters -->
                    <div
                        class="border-t border-slate-100 dark:border-slate-700 px-3 py-2.5 flex flex-wrap items-center gap-2">
                        <!-- Región -->
                        <div class="flex items-center gap-1.5">
                            <span class="material-symbols-outlined text-slate-400 text-[16px]">location_on</span>
                            <select id="regionSelect"
                                class="form-select bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold rounded-lg border border-slate-200 dark:border-slate-600 focus:ring-1 focus:ring-primary py-1.5 pl-2 pr-7 cursor-pointer">
                                <option value="">Región: Todas</option>
                                <option value="Lima">Lima</option>
                                <option value="Callao">Callao</option>
                                <option value="Junin">Junín</option>
                                <option value="Arequipa">Arequipa</option>
                                <option value="Puno">Puno</option>
                                <option value="Piura">Piura</option>
                                <option value="Cusco">Cusco</option>
                                <option value="La Libertad">La Libertad</option>
                                <option value="Ancash">Ancash</option>
                                <option value="Nacional">Nacional</option>
                            </select>
                        </div>
                        <div class="w-px h-5 bg-slate-200 dark:bg-slate-700"></div>
                        <!-- Organismo (dinámico) -->
                        <div class="flex items-center gap-1.5">
                            <span class="material-symbols-outlined text-slate-400 text-[16px]">account_balance</span>
                            <select id="agencySelect"
                                class="form-select bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold rounded-lg border border-slate-200 dark:border-slate-600 focus:ring-1 focus:ring-primary py-1.5 pl-2 pr-7 cursor-pointer max-w-[160px]">
                                <option value="">Organismo: Todos</option>
                            </select>
                        </div>
                        <div class="w-px h-5 bg-slate-200 dark:bg-slate-700"></div>
                        <!-- Presupuesto Rango -->
                        <div class="flex items-center gap-1.5">
                            <span class="material-symbols-outlined text-slate-400 text-[16px]">payments</span>
                            <span class="text-xs font-semibold text-slate-500">S/</span>
                            <input id="budgetMin" type="number" placeholder="Mín"
                                class="w-24 text-xs py-1.5 px-2 rounded-lg bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 focus:ring-1 focus:ring-primary text-slate-700 dark:text-slate-200 tabular-nums" />
                            <span class="text-slate-400 text-xs font-bold">—</span>
                            <input id="budgetMax" type="number" placeholder="Máx"
                                class="w-24 text-xs py-1.5 px-2 rounded-lg bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 focus:ring-1 focus:ring-primary text-slate-700 dark:text-slate-200 tabular-nums" />
                        </div>
                        <div class="w-px h-5 bg-slate-200 dark:bg-slate-700"></div>
                        <!-- Match -->
                        <div class="flex items-center gap-1.5">
                            <span class="material-symbols-outlined text-slate-400 text-[16px]">target</span>
                            <select id="matchSelect"
                                class="form-select bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold rounded-lg border border-slate-200 dark:border-slate-600 focus:ring-1 focus:ring-primary py-1.5 pl-2 pr-7 cursor-pointer">
                                <option value="">Match: Todos</option>
                                <option value="25">25%+</option>
                                <option value="50">50%+</option>
                                <option value="75">75%+</option>
                            </select>
                        </div>
                        <div class="w-px h-5 bg-slate-200 dark:bg-slate-700"></div>
                        <!-- Estatus -->
                        <div class="flex items-center gap-1.5">
                            <span class="material-symbols-outlined text-slate-400 text-[16px]">info</span>
                            <select id="statusSelect"
                                class="form-select bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold rounded-lg border border-slate-200 dark:border-slate-600 focus:ring-1 focus:ring-primary py-1.5 pl-2 pr-7 cursor-pointer">
                                <option value="">Estatus: Todos</option>
                                <option value="abierta">Abierta</option>
                                <option value="cierre">Cierre Próximo</option>
                                <option value="cerrada">Cerrada</option>
                            </select>
                        </div>
                        <div class="w-px h-5 bg-slate-200 dark:bg-slate-700"></div>
                        <!-- Solo Activas Toggle -->
                        <label class="relative inline-flex items-center cursor-pointer gap-2">
                            <input id="activeOnlyToggle" type="checkbox" value="" class="sr-only peer">
                            <div
                                class="w-8 h-4 bg-slate-200 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3.5 after:w-3.5 after:transition-all dark:border-gray-600 peer-checked:bg-primary relative">
                            </div>
                            <span
                                class="text-xs font-semibold text-slate-500 dark:text-slate-400 whitespace-nowrap">Solo
                                Activas</span>
                        </label>
                        <!-- Limpiar filtros -->
                        <button id="clearFiltersBtn" onclick="clearFilters()"
                            class="ml-auto text-xs font-semibold text-slate-400 hover:text-red-500 flex items-center gap-1 transition-colors">
                            <span class="material-symbols-outlined text-sm">filter_alt_off</span>
                            Limpiar
                        </button>
                    </div>
                </div>
                <!-- Active Filters Chips -->
                <div id="activeFilters" class="mt-3 flex flex-wrap gap-2">
                    <!-- Las etiquetas de filtros activos se inyectarán por JS -->
                </div>
        </header>
        <!-- Results Table Section (only visible in Search view) -->
        <section id="searchResultsSection" class="flex-1 overflow-hidden px-8 pb-8 flex flex-col">
            <div
                class="bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex flex-col h-full overflow-hidden">
                <!-- Table Toolbar -->
                <div
                    class="px-6 py-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-white dark:bg-[#1e293b]">
                    <h2 class="text-base font-semibold text-slate-800 dark:text-slate-200">
                        Resultados <span id="resultsCount" class="text-slate-400 font-normal text-sm ml-1">(0
                            encontrados)</span>
                    </h2>
                    <div class="flex items-center gap-3">
                        <button id="exportCsvBtn" onclick="exportCSV()"
                            class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-slate-700 text-slate-500 hover:text-primary hover:border-primary transition-all text-xs font-bold">
                            <span class="material-symbols-outlined text-sm">download</span>
                            Exportar CSV
                        </button>
                        <div class="w-px h-4 bg-slate-200 dark:bg-slate-700"></div>
                        <span class="text-sm text-slate-500">Ordenar por:</span>
                        <select id="sortSelect"
                            class="form-select text-sm border-none bg-slate-50 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg py-1.5 pl-3 pr-8 focus:ring-0 cursor-pointer font-medium">
                            <option>Relevancia (Match)</option>
                            <option>Fecha de Publicación</option>
                            <option>Presupuesto (Mayor a Menor)</option>
                            <option>Cierre Próximo</option>
                        </select>
                    </div>
                </div>
                <!-- Scrollable Table Area -->
                <div class="flex-1 overflow-auto w-full custom-scrollbar">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 dark:bg-slate-800/50 sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[30%]">
                                    Título de la Licitación</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[15%]">
                                    Organismo / Estado</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[15%]">
                                    Presupuesto (S/)</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[15%]">
                                    Cierre de Presentación</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[10%] text-center">
                                    Match</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[10%] text-center">
                                    Estatus</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[5%] text-center">
                                    Docs</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[3%]">
                                </th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody" class="divide-y divide-slate-100 dark:divide-slate-700">
                            <!-- Los resultados dinámicos irán aquí -->
                        </tbody>
                    </table>

                    <!-- Skeleton Loader (visible mientras carga) -->
                    <div id="skeletonLoader" class="p-6 space-y-4">
                        <div class="skeleton h-12 w-full"></div>
                        <div class="skeleton h-12 w-full"></div>
                        <div class="skeleton h-12 w-full"></div>
                        <div class="skeleton h-12 w-3/4"></div>
                    </div>

                    <!-- ESTADO VACÍO con sugerencias -->
                    <div id="emptyState" class="hidden py-16 text-center px-8">
                        <span class="material-symbols-outlined text-6xl text-slate-200 mb-4">search_off</span>
                        <h3 class="text-lg font-bold text-slate-800 dark:text-slate-200 mb-2">No hay licitaciones con
                            estos
                            filtros</h3>
                        <p class="text-slate-500 text-sm mb-6">Intenta ajustando las palabras clave o el rango de
                            presupuesto.</p>
                        <div class="flex flex-wrap justify-center gap-2">
                            <button onclick="suggestSearch('acero')"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-primary/10 hover:text-primary text-slate-600 rounded-full text-xs font-semibold transition-all">Probar:
                                acero</button>
                            <button onclick="suggestSearch('puente')"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-primary/10 hover:text-primary text-slate-600 rounded-full text-xs font-semibold transition-all">Probar:
                                puente</button>
                            <button onclick="suggestSearch('metalmecánica')"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-primary/10 hover:text-primary text-slate-600 rounded-full text-xs font-semibold transition-all">Probar:
                                metalmecánica</button>
                            <button onclick="suggestSearch('techado')"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-primary/10 hover:text-primary text-slate-600 rounded-full text-xs font-semibold transition-all">Probar:
                                techado</button>
                        </div>
                    </div>

                    <!-- Mobile Card View -->
                    <div id="mobileCards" class="mobile-cards p-4 space-y-3"></div>
                </div>

                <!-- Pagination Footer (Se ocultará si hay 0 resultados) -->
                <div id="paginationFooter"
                    class="px-6 py-4 border-t border-slate-100 dark:border-slate-700 flex items-center justify-between bg-white dark:bg-[#1e293b]">
                    <div class="text-sm text-slate-500 dark:text-slate-400">
                        Mostrando <span id="currentRange" class="font-medium text-slate-900 dark:text-white">...</span>
                        de <span id="totalResultsText" class="font-medium text-slate-900 dark:text-white">...</span>
                        resultados
                    </div>
                    <div class="flex gap-2">
                        <button
                            class="px-3 py-1 rounded border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm hover:bg-slate-50 dark:hover:bg-slate-800 disabled:opacity-50"
                            disabled="">Anterior</button>
                        <button class="px-3 py-1 rounded bg-primary text-white text-sm hover:bg-blue-600">1</button>
                        <button
                            class="px-3 py-1 rounded border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm hover:bg-slate-50 dark:hover:bg-slate-800">2</button>
                        <button
                            class="px-3 py-1 rounded border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm hover:bg-slate-50 dark:hover:bg-slate-800">3</button>
                        <span class="px-2 text-slate-400">...</span>
                        <button
                            class="px-3 py-1 rounded border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm hover:bg-slate-50 dark:hover:bg-slate-800">Siguiente</button>
                    </div>
                </div>
            </div>
        </section>
        </div> <!-- Cierre de searchView -->

        <!-- Dashboard View -->
        <div id="dashboardView"
            class="view-section hidden flex-1 overflow-y-auto bg-background-light dark:bg-background-dark p-8">
            <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight mb-8">Panel de Control</h1>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2">Oportunidades Totales</p>
                    <p id="statTotal" class="text-4xl font-black text-primary">0</p>
                </div>
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2">Presupuesto en Obras</p>
                    <p id="statBudget" class="text-4xl font-black text-green-500">S/ 0</p>
                </div>
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2">Match Promedio</p>
                    <p id="statMatch" class="text-4xl font-black text-orange-500">0%</p>
                </div>
            </div>
            <div class="bg-primary/5 border border-primary/20 p-8 rounded-2xl mb-8">
                <h2 class="font-bold text-primary mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined">analytics</span> Inteligencia de Mercado
                </h2>
                <p class="text-sm text-slate-600 dark:text-slate-400 leading-relaxed">
                    Este mes se han detectado procesos que requieren estructuras metálicas en varias regiones del Perú.
                    Le recomendamos enfocar su búsqueda en <strong>Junín</strong> y <strong>Lima</strong>, donde se
                    concentran los mayores presupuestos.
                </p>
            </div>
            <!-- MATERIALES MÁS DEMANDADOS -->
            <div
                class="bg-white dark:bg-surface-dark p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-sm">inventory_2</span> Top Materiales del Mes
                </h3>
                <div id="topMaterials" class="space-y-3">
                    <!-- Inyectado por JS -->
                </div>
            </div>
        </div>

        <!-- Pipeline / Kanban View -->
        <div id="pipelineView"
            class="view-section hidden flex-1 flex flex-col overflow-hidden bg-slate-50 dark:bg-background-dark">
            <!-- Pipeline Header -->
            <div class="px-8 pt-8 pb-4 shrink-0">
                <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-6">
                    <div>
                        <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight mb-1">Mis
                            Licitaciones</h1>
                        <p class="text-slate-500 dark:text-slate-400">Gestiona y rastrea el progreso de tus
                            oportunidades comerciales.</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <span id="pipelineTotal" class="text-sm text-slate-500 font-medium">0 procesos activos</span>
                        <button onclick="renderKanban()"
                            class="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg text-sm font-bold shadow-md shadow-primary/20 hover:bg-blue-700 transition-all">
                            <span class="material-symbols-outlined text-sm">refresh</span> Actualizar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Kanban Board (horizontal scroll) -->
            <div class="flex-1 overflow-hidden px-8 pb-4">
                <div class="flex gap-5 h-full overflow-x-auto pb-4"
                    style="-webkit-overflow-scrolling: touch; scrollbar-width: thin;">

                    <!-- Columna: Por Evaluar -->
                    <div class="flex flex-col gap-3 shrink-0 w-72">
                        <div class="flex items-center justify-between px-1">
                            <h3 class="font-black text-slate-700 dark:text-slate-300 flex items-center gap-2 text-sm">
                                <span class="w-2 h-2 rounded-full bg-blue-400"></span>
                                Por Evaluar
                                <span id="countEvaluar" class="text-slate-400 font-normal text-xs ml-1">(0)</span>
                            </h3>
                        </div>
                        <div id="kanbanEvaluar" class="flex flex-col gap-3 overflow-y-auto flex-1 pr-1"></div>
                    </div>

                    <!-- Columna: En Cotización -->
                    <div class="flex flex-col gap-3 shrink-0 w-72">
                        <div class="flex items-center justify-between px-1">
                            <h3 class="font-black text-slate-700 dark:text-slate-300 flex items-center gap-2 text-sm">
                                <span class="w-2 h-2 rounded-full bg-amber-400"></span>
                                En Cotización
                                <span id="countCotizar" class="text-slate-400 font-normal text-xs ml-1">(0)</span>
                            </h3>
                        </div>
                        <div id="kanbanCotizar" class="flex flex-col gap-3 overflow-y-auto flex-1 pr-1"></div>
                    </div>

                    <!-- Columna: Presentada -->
                    <div class="flex flex-col gap-3 shrink-0 w-72">
                        <div class="flex items-center justify-between px-1">
                            <h3 class="font-black text-slate-700 dark:text-slate-300 flex items-center gap-2 text-sm">
                                <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                                Presentada
                                <span id="countPresentada" class="text-slate-400 font-normal text-xs ml-1">(0)</span>
                            </h3>
                        </div>
                        <div id="kanbanPresentada" class="flex flex-col gap-3 overflow-y-auto flex-1 pr-1"></div>
                    </div>

                    <!-- Columna: Adjudicada -->
                    <div class="flex flex-col gap-3 shrink-0 w-72">
                        <div class="flex items-center justify-between px-1">
                            <h3 class="font-black text-slate-700 dark:text-slate-300 flex items-center gap-2 text-sm">
                                <span class="w-2 h-2 rounded-full bg-green-500"></span>
                                Adjudicada
                                <span id="countAdjudicada" class="text-slate-400 font-normal text-xs ml-1">(0)</span>
                            </h3>
                        </div>
                        <div id="kanbanAdjudicada" class="flex flex-col gap-3 overflow-y-auto flex-1 pr-1"></div>
                    </div>

                    <!-- Placeholder column -->
                    <div class="flex flex-col shrink-0 w-64 opacity-30">
                        <div
                            class="flex-1 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl flex flex-col items-center justify-center p-8 mt-8">
                            <span class="material-symbols-outlined text-4xl text-slate-400 mb-2">add_circle</span>
                            <p class="text-xs font-semibold text-slate-500 text-center">Agrega más etapas según tu
                                proceso</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Stats -->
            <div
                class="shrink-0 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-surface-dark px-8 py-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Valor Total en
                            Pipeline</p>
                        <p id="pipelineValor" class="text-xl font-black text-primary">S/ 0</p>
                    </div>
                    <div>
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">En Cotización
                        </p>
                        <p id="pipelineCotizando" class="text-xl font-black text-amber-500">0</p>
                    </div>
                    <div>
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Cierres Próximos
                        </p>
                        <p id="pipelineUrgentes" class="text-xl font-black text-red-500">0</p>
                    </div>
                    <div>
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Match Promedio
                        </p>
                        <p id="pipelineMatchAvg" class="text-xl font-black text-green-600">0%</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analíticas View -->
        <div id="analyticsView"
            class="view-section hidden flex-1 overflow-y-auto bg-slate-50 dark:bg-background-dark p-8 space-y-8">

            <!-- Header & Period Toggle -->
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight">Panel de Analíticas
                    </h1>
                    <p class="text-slate-500 dark:text-slate-400 font-medium mt-1">Monitoreo inteligente del mercado de
                        licitaciones SEACE.</p>
                </div>
                <div
                    class="flex items-center gap-1 bg-white dark:bg-surface-dark p-1 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                    <button
                        class="px-4 py-2 text-xs font-bold rounded-lg text-slate-600 hover:bg-slate-50 transition-all">Mensual</button>
                    <button
                        class="px-4 py-2 text-xs font-bold rounded-lg bg-primary text-white shadow-md shadow-primary/20">Trimestral</button>
                    <button
                        class="px-4 py-2 text-xs font-bold rounded-lg text-slate-600 hover:bg-slate-50 transition-all">Anual</button>
                </div>
            </div>

            <!-- KPI Cards (dynamic) -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-2 bg-primary/10 text-primary rounded-xl"><span
                                class="material-symbols-outlined">description</span></div>
                        <span
                            class="text-xs font-bold text-slate-400 bg-slate-50 dark:bg-slate-800 px-2 py-1 rounded-full">Disponibles</span>
                    </div>
                    <p class="text-sm font-semibold text-slate-500 mb-1">Total Licitaciones</p>
                    <p id="kpiTotal" class="text-3xl font-black mt-1 text-slate-900 dark:text-white">0</p>
                </div>
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-2 bg-green-100 text-green-600 rounded-xl"><span
                                class="material-symbols-outlined">payments</span></div>
                        <span
                            class="text-xs font-bold text-green-600 bg-green-50 dark:bg-green-950/30 px-2 py-1 rounded-full">Presupuesto</span>
                    </div>
                    <p class="text-sm font-semibold text-slate-500 mb-1">Valor Total SEACE</p>
                    <p id="kpiValor" class="text-3xl font-black mt-1 text-slate-900 dark:text-white">S/ 0</p>
                </div>
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-2 bg-amber-100 text-amber-600 rounded-xl"><span
                                class="material-symbols-outlined">target</span></div>
                        <span
                            class="text-xs font-bold text-amber-600 bg-amber-50 dark:bg-amber-950/30 px-2 py-1 rounded-full">INPROMETAL</span>
                    </div>
                    <p class="text-sm font-semibold text-slate-500 mb-1">Match Promedio</p>
                    <p id="kpiMatch" class="text-3xl font-black mt-1 text-slate-900 dark:text-white">0%</p>
                </div>
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-2 bg-purple-100 text-purple-600 rounded-xl"><span
                                class="material-symbols-outlined">view_kanban</span></div>
                        <span
                            class="text-xs font-bold text-purple-600 bg-purple-50 dark:bg-purple-950/30 px-2 py-1 rounded-full">Pipeline</span>
                    </div>
                    <p class="text-sm font-semibold text-slate-500 mb-1">En Pipeline</p>
                    <p id="kpiPipeline" class="text-3xl font-black mt-1 text-slate-900 dark:text-white">0</p>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Bar Chart: Top Organismos -->
                <div
                    class="lg:col-span-2 bg-white dark:bg-surface-dark p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-base font-black text-slate-900 dark:text-white">Volumen por Organismo</h3>
                            <p class="text-xs text-slate-500 font-medium mt-0.5">Licitaciones publicadas en SEACE</p>
                        </div>
                    </div>
                    <div id="agencyBarChart" class="flex items-end justify-between gap-3 h-44 px-1">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Match Distribution -->
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm">
                    <h3 class="text-base font-black text-slate-900 dark:text-white mb-5">Distribución de Match</h3>
                    <div class="flex justify-center py-4">
                        <div class="relative w-40 h-40 flex items-center justify-center">
                            <svg class="w-40 h-40 -rotate-90" viewBox="0 0 36 36">
                                <circle cx="18" cy="18" r="14" fill="none" stroke="#e2e8f0" stroke-width="4"></circle>
                                <circle id="donutHigh" cx="18" cy="18" r="14" fill="none" stroke="#135bec"
                                    stroke-width="4" stroke-dasharray="0 100" stroke-linecap="round"></circle>
                                <circle id="donutMed" cx="18" cy="18" r="14" fill="none" stroke="#f59e0b"
                                    stroke-width="4" stroke-dasharray="0 100" stroke-dashoffset="0"
                                    stroke-linecap="round"></circle>
                            </svg>
                            <div class="absolute text-center">
                                <p id="donutLabel" class="text-2xl font-black text-slate-900 dark:text-white">0%</p>
                                <p class="text-[10px] font-black text-slate-400 uppercase tracking-wider">Match Alto</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2.5 mt-4" id="matchLegend">
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 rounded-full bg-primary"></div><span
                                    class="text-slate-600 dark:text-slate-400 font-medium">75-100% Match</span>
                            </div>
                            <span id="matchHigh" class="font-bold text-slate-800 dark:text-slate-200">0</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 rounded-full bg-amber-400"></div><span
                                    class="text-slate-600 dark:text-slate-400 font-medium">25-50% Match</span>
                            </div>
                            <span id="matchMed" class="font-bold text-slate-800 dark:text-slate-200">0</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 rounded-full bg-slate-200"></div><span
                                    class="text-slate-600 dark:text-slate-400 font-medium">0% Match</span>
                            </div>
                            <span id="matchLow" class="font-bold text-slate-800 dark:text-slate-200">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lower Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Top Agencies Table -->
                <div
                    class="bg-white dark:bg-surface-dark rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden">
                    <div
                        class="px-6 py-4 border-b border-slate-100 dark:border-slate-700 flex items-center justify-between">
                        <h3 class="text-base font-black text-slate-900 dark:text-white">Organismos más activos</h3>
                        <span
                            class="text-xs font-bold text-primary bg-primary/10 px-3 py-1 rounded-full">Metalmecánica</span>
                    </div>
                    <div id="topAgenciesTable" class="divide-y divide-slate-100 dark:divide-slate-700">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- AI Insights Panel -->
                <div
                    class="bg-primary/5 dark:bg-primary/10 rounded-xl border border-primary/20 p-6 flex flex-col justify-between">
                    <div>
                        <div class="flex items-center gap-2 text-primary mb-5">
                            <span class="material-symbols-outlined">auto_awesome</span>
                            <h3 class="text-base font-black">Insights del Mercado</h3>
                        </div>
                        <div id="insightsPanel" class="space-y-5">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                    <div class="mt-6 bg-white dark:bg-surface-dark p-4 rounded-xl shadow-sm">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Top Material
                            Demandado</p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-amber-500">construction</span>
                                <span id="topMaterialInsight"
                                    class="text-sm font-black text-slate-900 dark:text-white">---</span>
                            </div>
                            <span id="topMaterialCount" class="text-xs font-black text-slate-500">0 procesos</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- PANEL LATERAL (Drawer) - Se desliza desde la derecha -->
    <div id="drawerOverlay" class="fixed inset-0 bg-black/40 z-40 hidden opacity-0 transition-opacity duration-300"
        onclick="closeDrawer()"></div>
    <aside id="drawerPanel"
        class="fixed top-0 right-0 h-full w-full md:w-[520px] bg-white dark:bg-slate-900 z-50 shadow-2xl transform translate-x-full transition-transform duration-300 ease-out overflow-y-auto">
        <!-- Drawer Header -->
        <div
            class="sticky top-0 z-10 bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span id="drawerBadge"
                    class="px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700">Abierta</span>
                <span id="drawerId" class="text-xs font-mono text-slate-400">---</span>
            </div>
            <div class="flex items-center gap-2">
                <button id="drawerFollowBtn" onclick="toggleDrawerFollow()"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-200 text-slate-500 hover:border-primary hover:text-primary transition-all text-xs font-bold">
                    <span class="material-symbols-outlined text-sm">bookmark</span> Seguir
                </button>
                <a id="drawerFullLink" href="#"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-primary text-white text-xs font-bold hover:bg-blue-600 transition-all">
                    <span class="material-symbols-outlined text-sm">open_in_new</span> Ver completo
                </a>
                <button onclick="closeDrawer()"
                    class="p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-700 transition-all">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>
        <!-- Drawer Body -->
        <div class="p-6 space-y-6">
            <div>
                <h2 id="drawerTitle" class="text-xl font-black text-slate-900 dark:text-white leading-tight mb-3">---
                </h2>
                <div class="flex flex-wrap items-center gap-3 text-xs text-slate-500">
                    <span class="flex items-center gap-1"><span
                            class="material-symbols-outlined text-sm">account_balance</span> <span id="drawerAgency"
                            class="font-bold text-slate-700">---</span></span>
                    <span class="text-slate-300">|</span>
                    <span class="flex items-center gap-1"><span
                            class="material-symbols-outlined text-sm">location_on</span> <span
                            id="drawerLocation">---</span></span>
                </div>
            </div>
            <!-- Presupuesto -->
            <div class="bg-slate-50 dark:bg-slate-800 p-5 rounded-2xl">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Presupuesto Referencial
                </p>
                <p id="drawerBudget"
                    class="text-3xl font-black text-slate-900 dark:text-white tracking-tighter tabular-nums">S/ 0</p>
                <!-- SEMÁFORO FINANCIERO -->
                <div id="drawerSemaforo" class="mt-3 flex items-center gap-2 text-xs hidden">
                    <span id="semaforoIcon" class="material-symbols-outlined text-sm">traffic</span>
                    <span id="semaforoText" class="font-bold">---</span>
                </div>
            </div>
            <!-- PIPELINE STAGE SELECTOR -->
            <div class="bg-slate-50 border border-slate-200 p-5 rounded-2xl">
                <h4
                    class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3 flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">view_kanban</span> Estado del Pipeline
                </h4>
                <div class="space-y-2">
                    <button onclick="setPipelineStage('evaluar')"
                        class="pipeline-stage-btn w-full text-left px-3 py-2 rounded-lg text-xs font-bold transition-all flex items-center gap-2 border border-slate-200 hover:border-blue-400 hover:bg-blue-50">
                        <span class="w-2 h-2 rounded-full bg-blue-400"></span> Por Evaluar
                    </button>
                    <button onclick="setPipelineStage('cotizar')"
                        class="pipeline-stage-btn w-full text-left px-3 py-2 rounded-lg text-xs font-bold transition-all flex items-center gap-2 border border-slate-200 hover:border-amber-400 hover:bg-amber-50">
                        <span class="w-2 h-2 rounded-full bg-amber-400"></span> En Cotización
                    </button>
                    <button onclick="setPipelineStage('presentada')"
                        class="pipeline-stage-btn w-full text-left px-3 py-2 rounded-lg text-xs font-bold transition-all flex items-center gap-2 border border-slate-200 hover:border-purple-400 hover:bg-purple-50">
                        <span class="w-2 h-2 rounded-full bg-purple-500"></span> Presentada
                    </button>
                    <button onclick="setPipelineStage('adjudicada')"
                        class="pipeline-stage-btn w-full text-left px-3 py-2 rounded-lg text-xs font-bold transition-all flex items-center gap-2 border border-slate-200 hover:border-green-400 hover:bg-green-50">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span> Adjudicada
                    </button>
                </div>
                <p id="drawerPipelineStatus" class="text-[10px] text-slate-400 text-center mt-3 hidden">✓ Guardado en
                    pipeline</p>
            </div>
            <!-- Descripción -->
            <div>
                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Objeto del Proceso</h4>
                <p id="drawerDesc" class="text-sm text-slate-700 dark:text-slate-300 leading-relaxed">---</p>
            </div>
            <!-- Timeline Rápido -->
            <div>
                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Cronograma</h4>
                <div id="drawerTimeline" class="space-y-3"></div>
            </div>
            <!-- Documentos -->
            <div>
                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Documentos</h4>
                <div class="space-y-2">
                    <div
                        class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-xl hover:bg-primary/5 transition-all cursor-pointer group">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-red-500">picture_as_pdf</span>
                            <div>
                                <p class="text-xs font-bold text-slate-700">Bases Administrativas</p>
                                <p class="text-[10px] text-slate-400">PDF</p>
                            </div>
                        </div>
                        <span
                            class="material-symbols-outlined text-slate-300 group-hover:text-primary text-sm">download</span>
                    </div>
                    <div
                        class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-xl hover:bg-primary/5 transition-all cursor-pointer group">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-blue-500">folder_zip</span>
                            <div>
                                <p class="text-xs font-bold text-slate-700">Expediente Técnico</p>
                                <p class="text-[10px] text-slate-400">ZIP • Planos y anexos</p>
                            </div>
                        </div>
                        <span
                            class="material-symbols-outlined text-slate-300 group-hover:text-primary text-sm">download</span>
                    </div>
                </div>
            </div>
            <!-- Requisitos -->
            <div>
                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Requisitos</h4>
                <div id="drawerRequirements" class="space-y-2"></div>
            </div>
            <!-- IA BID / NO-BID SCORE -->
            <div id="bidNoBidPanel" class="rounded-2xl border border-slate-200 overflow-hidden">
                <button onclick="toggleBidPanel()"
                    class="w-full flex items-center justify-between px-5 py-4 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
                    <span class="text-xs font-black text-slate-700 uppercase tracking-widest flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm">fact_check</span> Análisis Bid / No-Bid
                    </span>
                    <span id="bidScore"
                        class="text-xs font-black px-3 py-1 rounded-full bg-slate-200 text-slate-500">---</span>
                </button>
                <div id="bidNoBidBody" class="hidden px-5 pb-5 pt-3 space-y-3 bg-white">
                    <div id="bidChecklist" class="space-y-2"></div>
                    <div id="bidRecommendation" class="mt-3 p-3 rounded-xl text-xs font-semibold"></div>
                </div>
            </div>
            <!-- IA Insight -->
            <div class="bg-primary rounded-2xl p-5 text-white">
                <p class="text-[10px] font-black uppercase tracking-widest mb-2 opacity-60">IA Insights</p>
                <p class="text-sm font-semibold leading-relaxed">Proceso con <span
                        class="bg-white/20 px-1.5 py-0.5 rounded text-xs font-black">ALTA AFINIDAD</span> para
                    INPROMETAL. Calza con su especialidad en Fabricaciones Metálicas.</p>
            </div>
            <!-- BOTÓN GENERAR PRE-COTIZACIÓN -->
            <div class="flex gap-2">
                <button onclick="enviarWebhook()"
                    class="flex-1 py-4 bg-green-600 hover:bg-green-700 text-white rounded-2xl font-black text-sm uppercase tracking-widest flex items-center justify-center gap-2 shadow-lg shadow-green-600/20 transition-all hover:scale-[1.01]">
                    <span class="material-symbols-outlined">send</span>
                    Enviar a CRM
                </button>
                <button onclick="copiarDatos()"
                    class="py-4 px-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-2xl font-black text-sm transition-all flex items-center justify-center gap-1"
                    title="Copiar datos">
                    <span class="material-symbols-outlined">content_copy</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- ONBOARDING / COMPANY PROFILE MODAL -->
    <div id="onboardingModal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4"
        style="background:rgba(0,0,0,0.65);backdrop-filter:blur(6px);display:none;">
        <div
            style="background:#ffffff;border-radius:20px;box-shadow:0 25px 60px rgba(0,0,0,0.35);width:100%;max-width:540px;max-height:90vh;overflow-y:auto;">
            <!-- Header -->
            <div style="padding:28px 32px 16px;border-bottom:1px solid #e2e8f0;">
                <div style="display:flex;align-items:center;gap:12px;">
                    <div style="background:#eff6ff;padding:8px;border-radius:12px;">
                        <span class="material-symbols-outlined" style="color:#135bec;">business</span>
                    </div>
                    <div>
                        <h2 style="font-size:18px;font-weight:900;color:#0f172a;margin:0;">Perfil de tu Empresa</h2>
                        <p style="font-size:12px;color:#64748b;margin:2px 0 0;">Calibra el motor de Match para tu rubro
                        </p>
                    </div>
                    <button onclick="closeOnboarding()"
                        style="margin-left:auto;padding:6px;border:none;background:transparent;cursor:pointer;color:#94a3b8;border-radius:8px;"><span
                            class="material-symbols-outlined">close</span></button>
                </div>
            </div>
            <!-- Body -->
            <div style="padding:24px 32px 32px;display:flex;flex-direction:column;gap:20px;">
                <!-- Nombre -->
                <div>
                    <label
                        style="font-size:11px;font-weight:800;color:#64748b;text-transform:uppercase;letter-spacing:.08em;display:block;margin-bottom:6px;">Nombre
                        de la Empresa</label>
                    <input id="profileCompany" type="text" placeholder="Ej: INPROMETAL SAC"
                        style="width:100%;padding:12px 16px;border:1.5px solid #e2e8f0;border-radius:12px;font-size:14px;font-weight:600;color:#0f172a;background:#fff;outline:none;box-sizing:border-box;"
                        onfocus="this.style.borderColor='#135bec'" onblur="this.style.borderColor='#e2e8f0'" />
                </div>
                <!-- Sector + AI Suggest -->
                <div>
                    <label
                        style="font-size:11px;font-weight:800;color:#64748b;text-transform:uppercase;letter-spacing:.08em;display:block;margin-bottom:6px;">Sector
                        / Rubro Principal</label>
                    <div style="display:flex;gap:8px;">
                        <select id="profileSector" onchange="suggestKeywordsBySector()"
                            style="flex:1;padding:12px 16px;border:1.5px solid #e2e8f0;border-radius:12px;font-size:14px;font-weight:600;color:#0f172a;background:#fff;outline:none;cursor:pointer;">
                            <option value="metal">Metalmecánica / Estructuras Metálicas</option>
                            <option value="ti">Tecnología de la Información (TI)</option>
                            <option value="construccion">Construcción Civil</option>
                            <option value="salud">Insumos Médicos / Salud</option>
                            <option value="consultoria">Consultoría / Servicios Profesionales</option>
                            <option value="electricidad">Electricidad / Suministro Eléctrico</option>
                            <option value="otro">Otro Rubro</option>
                        </select>
                        <button onclick="suggestKeywordsBySector()" title="IA: sugerir keywords para este sector"
                            style="padding:12px 14px;background:#eff6ff;border:1.5px solid #bfdbfe;border-radius:12px;cursor:pointer;color:#135bec;font-size:12px;font-weight:800;white-space:nowrap;display:flex;align-items:center;gap:4px;">
                            <span class="material-symbols-outlined" style="font-size:16px;">auto_awesome</span> IA
                        </button>
                    </div>
                    <!-- AI Suggestion Box -->
                    <div id="sectorSuggestionBox"
                        style="display:none;margin-top:8px;padding:10px 14px;background:#f0f9ff;border:1px solid #bae6fd;border-radius:10px;">
                        <p style="font-size:11px;font-weight:700;color:#0284c7;margin:0 0 4px;">&#x2728; Sugerencia IA
                            para tu sector:</p>
                        <p id="sectorSuggestionText" style="font-size:12px;color:#0369a1;margin:0;"></p>
                        <button onclick="applySuggestion()"
                            style="margin-top:8px;padding:4px 12px;background:#0284c7;color:#fff;border:none;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;">Aplicar
                            sugerencia</button>
                    </div>
                </div>
                <!-- CUBSO / Keywords -->
                <div>
                    <label
                        style="font-size:11px;font-weight:800;color:#64748b;text-transform:uppercase;letter-spacing:.08em;display:block;margin-bottom:6px;">
                        Palabras Clave / Códigos CUBSO
                        <span
                            style="font-size:10px;font-weight:600;color:#94a3b8;text-transform:none;letter-spacing:0;">
                            — definen tu % de Match</span>
                    </label>
                    <textarea id="profileKeywords" rows="3"
                        placeholder="Ej: acero, fierro, estructuras, baranda, fabricación metálica..."
                        style="width:100%;padding:12px 16px;border:1.5px solid #e2e8f0;border-radius:12px;font-size:14px;font-weight:600;color:#0f172a;background:#fff;outline:none;resize:none;box-sizing:border-box;font-family:inherit;"
                        onfocus="this.style.borderColor='#135bec'" onblur="this.style.borderColor='#e2e8f0'"></textarea>
                    <p style="font-size:11px;color:#94a3b8;margin:4px 0 0;">&#128161; El sistema compara estas palabras
                        con los títulos y descripciones de cada licitación. Más coincidencias = mayor Match %.</p>
                </div>
                <!-- Capacidad máxima -->
                <div>
                    <label
                        style="font-size:11px;font-weight:800;color:#64748b;text-transform:uppercase;letter-spacing:.08em;display:block;margin-bottom:6px;">Capacidad
                        Máx. de Contrato (S/)</label>
                    <select id="profileCapacity"
                        style="width:100%;padding:12px 16px;border:1.5px solid #e2e8f0;border-radius:12px;font-size:14px;font-weight:600;color:#0f172a;background:#fff;outline:none;cursor:pointer;box-sizing:border-box;">
                        <option value="200000">Hasta S/ 200,000</option>
                        <option value="500000">Hasta S/ 500,000</option>
                        <option value="1000000" selected>Hasta S/ 1,000,000</option>
                        <option value="5000000">Hasta S/ 5,000,000</option>
                        <option value="99999999">Sin límite</option>
                    </select>
                </div>
                <!-- Webhooks -->
                <div>
                    <label
                        style="font-size:11px;font-weight:800;color:#64748b;text-transform:uppercase;letter-spacing:.08em;display:block;margin-bottom:6px;">Webhook
                        (Make.com / Zapier) <span style="font-weight:600;color:#94a3b8;text-transform:none;">—
                            opcional</span></label>
                    <input id="profileWebhook" type="url" placeholder="https://hook.make.com/tu-url"
                        style="width:100%;padding:12px 16px;border:1.5px solid #e2e8f0;border-radius:12px;font-size:13px;font-weight:600;color:#0f172a;background:#fff;outline:none;font-family:monospace;box-sizing:border-box;"
                        onfocus="this.style.borderColor='#135bec'" onblur="this.style.borderColor='#e2e8f0'" />
                    <p style="font-size:11px;color:#94a3b8;margin:4px 0 0;">Se activa automáticamente al mover una
                        licitación a "En Cotización".</p>
                </div>
                <!-- Buttons -->
                <div style="display:flex;gap:12px;padding-top:4px;">
                    <button onclick="closeOnboarding()"
                        style="flex:1;padding:14px;border:1.5px solid #e2e8f0;border-radius:12px;font-size:14px;font-weight:700;color:#475569;background:#fff;cursor:pointer;transition:background .2s;"
                        onmouseover="this.style.background='#f8fafc'"
                        onmouseout="this.style.background='#fff'">Cancelar</button>
                    <button onclick="saveProfile()"
                        style="flex:1;padding:14px;background:#135bec;border:none;border-radius:12px;font-size:14px;font-weight:800;color:#fff;cursor:pointer;box-shadow:0 4px 14px rgba(19,91,236,0.3);transition:background .2s;"
                        onmouseover="this.style.background='#1d4ed8'"
                        onmouseout="this.style.background='#135bec'">Guardar Perfil</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Offline Banner -->
    <div id="offlineBanner"
        class="fixed bottom-0 left-0 right-0 bg-red-600 text-white text-center py-3 text-sm font-bold z-50 hidden transition-all">
        <span class="material-symbols-outlined text-sm align-middle mr-1">wifi_off</span>
        Sin conexión a internet. Los datos mostrados pueden no estar actualizados.
    </div>

    <script src="app.js"></script>
</body>

</html>