<!DOCTYPE html>

<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Buscador de Licitaciones Inteligente</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="tailwind.config.js"></script>
    <style>
        /* Agregando estilos para scroll que venían del de detalles */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Skeleton Loader */
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .skeleton {
            background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        /* Responsive: Card view en móvil */
        @media (max-width: 768px) {
            .desktop-table {
                display: none !important;
            }

            .mobile-cards {
                display: block !important;
            }
        }

        @media (min-width: 769px) {
            .mobile-cards {
                display: none !important;
            }
        }

        /* Enterprise: Tabular Numbers */
        .tabular-nums {
            font-variant-numeric: tabular-nums;
        }

        /* Indicador de "Visto" */
        .row-visited {
            background-color: #f8fafc !important;
        }

        .row-visited td:first-child span:first-child {
            color: #94a3b8 !important;
        }

        /* Action Menu Dropdown */
        .action-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            z-index: 30;
        }

        .action-trigger:focus-within .action-menu {
            display: block;
        }

        /* Sticky first column on mobile scroll */
        @media (max-width: 1024px) {
            .sticky-col {
                position: sticky;
                left: 0;
                z-index: 5;
                background: inherit;
            }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            pointer-events: auto;
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: toastIn .3s ease-out, toastOut .3s ease-in 4s forwards;
            box-shadow: 0 8px 30px rgba(0, 0, 0, .12);
            max-width: 380px;
        }

        .toast-error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .toast-success {
            background: #f0fdf4;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        .toast-warning {
            background: #fffbeb;
            color: #d97706;
            border: 1px solid #fde68a;
        }

        .toast-info {
            background: #eff6ff;
            color: #2563eb;
            border: 1px solid #bfdbfe;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(80px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes toastOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        /* Semáforo Financiero */
        .semaforo-verde {
            color: #16a34a;
        }

        .semaforo-amarillo {
            color: #d97706;
        }

        .semaforo-rojo {
            color: #dc2626;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 font-display antialiased min-h-screen flex flex-col md:flex-row overflow-hidden">
    <!-- Sidebar -->
    <aside
        class="w-full md:w-64 bg-white dark:bg-[#1a2234] border-r border-slate-200 dark:border-slate-800 flex-shrink-0 flex flex-col h-screen sticky top-0">
        <!-- Brand -->
        <div class="h-16 flex items-center px-6 border-b border-slate-100 dark:border-slate-800">
            <div class="flex items-center gap-2 text-primary">
                <span class="material-symbols-outlined text-3xl">gavel</span>
                <span class="text-lg font-bold tracking-tight text-slate-900 dark:text-white">LICITADOR <span
                        class="text-primary">PE</span></span>
            </div>
        </div>
        <!-- User Profile (Simplified) -->
        <div class="p-4 border-b border-slate-100 dark:border-slate-800">
            <div class="flex items-center gap-3">
                <div class="bg-slate-200 dark:bg-slate-700 h-10 w-10 rounded-full bg-cover bg-center"
                    data-alt="User profile picture of a professional man in a suit"
                    style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBqGnUZw6TGxeEjeZ22zJNf-Q4AIf3dxxLXK03Y2dlLa9Se8gjG0M-yujkuXVNdtzLD5-Rt4TTI3XJlneiHZYJZAHkRN8gl-XeKiTaEb4Sm2WimT0RPdh48y-Uz5WVX-Dvvvx2rjpqpKPVvNR4CDDFl9kLY1HrRDStCfIRE72p7YnjZRhYfs-yEXXehHWVGHkX5IqhZtvrpNZJ4g6yT4AonT4X15jXTiNJlYkPfJ1HZSITiA9ZJxpCoqH72dPCQ3oExUayd4eTcuuI');">
                </div>
                <div class="flex flex-col">
                    <h3 class="text-sm font-semibold text-slate-900 dark:text-white">INPROMETAL SAC</h3>
                    <p class="text-xs text-slate-500 dark:text-slate-400">Plan Corporativo</p>
                </div>
            </div>
        </div>
        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
            <a id="navDashboard"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-primary transition-colors group cursor-pointer"
                onclick="switchView('dashboard')">
                <span class="material-symbols-outlined group-hover:text-primary">dashboard</span>
                <span class="text-sm font-medium">Dashboard</span>
            </a>
            <a id="navSearch"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary font-medium transition-colors cursor-pointer"
                onclick="switchView('search')">
                <span class="material-symbols-outlined fill-1">search</span>
                <span class="text-sm">Buscador</span>
            </a>
            <a id="navAnalytics"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-primary transition-colors group cursor-pointer"
                onclick="switchView('analytics')">
                <span class="material-symbols-outlined group-hover:text-primary">analytics</span>
                <span class="text-sm font-medium">Analíticas</span>
            </a>
            <!-- Smart Alerts Section -->
            <div class="pt-6 pb-2 px-3">
                <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Alertas Inteligentes</p>
            </div>
            <a id="alertNuevas"
                class="flex items-center justify-between px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 group transition-colors cursor-pointer"
                onclick="filterByAlert('nuevas')">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-orange-500">notifications_active</span>
                    <span class="text-sm font-medium">Nuevas Oportunidades</span>
                </div>
                <span id="badgeNuevas"
                    class="bg-orange-100 text-orange-600 text-xs font-bold px-2 py-0.5 rounded-full">0</span>
            </a>
            <a id="alertCierre"
                class="flex items-center justify-between px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 group transition-colors cursor-pointer"
                onclick="filterByAlert('cierre')">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-red-500">warning</span>
                    <span class="text-sm font-medium">Cierre Próximo</span>
                </div>
                <span id="badgeCierre"
                    class="bg-red-100 text-red-600 text-xs font-bold px-2 py-0.5 rounded-full">0</span>
            </a>
            <!-- Saved Searches Section -->
            <div class="pt-6 pb-2 px-3">
                <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Búsquedas Guardadas</p>
            </div>
            <span class="text-sm font-medium">Puentes Metálicos</span>
            </a>
            <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
                href="#">
                <span class="material-symbols-outlined text-slate-400 text-[20px]">bookmark</span>
                <span class="text-sm">Estructuras Lima</span>
            </a>
        </nav>
        <div class="p-4 border-t border-slate-100 dark:border-slate-800">
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors"
                href="#">
                <span class="material-symbols-outlined">settings</span>
                <span class="text-sm font-medium">Configuración</span>
            </a>
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors mt-1"
                href="#">
                <span class="material-symbols-outlined">logout</span>
                <span class="text-sm font-medium">Cerrar Sesión</span>
            </a>
        </div>
    </aside>
    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden bg-background-light dark:bg-background-dark relative">
        <!-- Gradient Background Decor -->
        <div
            class="absolute top-0 left-0 right-0 h-64 bg-gradient-to-b from-primary/5 to-transparent pointer-events-none">
        </div>
        <!-- Header Area -->
        <header class="flex-shrink-0 px-8 py-6 z-10">
            <!-- Secciones de Navegación -->
            <div id="searchView" class="view-section">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight mb-2">Buscador de
                            Licitaciones</h1>
                        <p class="text-slate-500 dark:text-slate-400">Encuentra oportunidades de gobierno
                            relevantes para INPROMETAL.</p>
                    </div>
                </div>
                <!-- Search Bar Container -->
                <div
                    class="bg-white dark:bg-[#1e293b] p-2 rounded-xl shadow-lg shadow-slate-200/50 dark:shadow-black/20 border border-slate-100 dark:border-slate-700 flex flex-col md:flex-row gap-2">
                    <div class="flex-1 relative flex items-center">
                        <span class="material-symbols-outlined absolute left-4 text-slate-400">search</span>
                        <input id="searchInput"
                            class="w-full pl-12 pr-4 py-3 bg-transparent border-none focus:ring-0 text-slate-900 dark:text-white placeholder-slate-400 text-base"
                            placeholder="Ej: Estructuras metálicas, fierro negro, mantenimiento..." type="text"
                            value="" />
                    </div>
                    <div class="h-px md:h-auto md:w-px bg-slate-200 dark:bg-slate-700 my-2 md:my-0"></div>
                    <!-- Quick Filters Row inside Search Bar -->
                    <div class="flex items-center gap-2 px-2 overflow-x-auto no-scrollbar">
                        <div class="relative group">
                            <select id="regionSelect"
                                class="form-select bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-sm font-medium rounded-lg border-none focus:ring-0 py-2 pl-3 pr-8 cursor-pointer appearance-none">
                                <option value="">Región: Todas</option>
                                <option value="Lima">Lima</option>
                                <option value="Callao">Callao</option>
                                <option value="Nacional">Nacional</option>
                            </select>
                        </div>
                        <div class="relative group">
                            <select id="cubsoSelect"
                                class="form-select bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-sm font-medium rounded-lg border-none focus:ring-0 py-2 pl-3 pr-8 cursor-pointer appearance-none">
                                <option value="">CUBSO: Todos</option>
                                <option value="7215">Estructuras Metálicas (7215)</option>
                                <option value="7212">Obras y Edificaciones (7212)</option>
                                <option value="9514">Fabricación de Metal (9514)</option>
                                <option value="OTROS">Otros Sectores</option>
                            </select>
                        </div>
                        <div class="relative group">
                            <select id="budgetSelect"
                                class="form-select bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-sm font-medium rounded-lg border-none focus:ring-0 py-2 pl-3 pr-8 cursor-pointer appearance-none">
                                <option value="">Presupuesto: Todos</option>
                                <option value="viable">S/ 50k - S/ 1M</option>
                                <option value="high">S/ 1M+ (Megaproyectos)</option>
                                <option value="low">Menor a S/ 50k</option>
                                <option value="custom">Personalizado...</option>
                            </select>
                        </div>
                        <div id="customBudgetInputs" class="hidden flex items-center gap-1">
                            <input id="budgetMin" type="number" placeholder="Mín"
                                class="w-20 text-xs py-2 px-2 rounded-lg bg-slate-50 dark:bg-slate-700 border-none focus:ring-1 focus:ring-primary text-slate-700 dark:text-slate-200" />
                            <span class="text-slate-400 text-xs">-</span>
                            <input id="budgetMax" type="number" placeholder="Máx"
                                class="w-20 text-xs py-2 px-2 rounded-lg bg-slate-50 dark:bg-slate-700 border-none focus:ring-1 focus:ring-primary text-slate-700 dark:text-slate-200" />
                        </div>
                        <div class="flex items-center gap-2 px-3 border-l border-slate-200 dark:border-slate-700 ml-2">
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input id="activeOnlyToggle" type="checkbox" value="" class="sr-only peer">
                                <div
                                    class="w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-primary">
                                </div>
                                <span
                                    class="ml-2 text-xs font-semibold text-slate-500 dark:text-slate-400 whitespace-nowrap">Solo
                                    Activas</span>
                            </label>
                        </div>
                    </div>
                    <button id="searchBtn"
                        class="bg-primary hover:bg-blue-700 text-white px-8 py-2.5 rounded-lg font-medium shadow-md shadow-blue-500/20 transition-all flex items-center justify-center gap-2">
                        Buscar
                    </button>
                </div>
                <!-- Active Filters Chips -->
                <div id="activeFilters" class="mt-4 flex flex-wrap gap-2">
                    <!-- Las etiquetas de filtros activos se inyectarán por JS -->
                </div>
        </header>
        <!-- Results Table Section -->
        <section class="flex-1 overflow-hidden px-8 pb-8 flex flex-col">
            <div
                class="bg-white dark:bg-[#1e293b] rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex flex-col h-full overflow-hidden">
                <!-- Table Toolbar -->
                <div
                    class="px-6 py-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-white dark:bg-[#1e293b]">
                    <h2 class="text-base font-semibold text-slate-800 dark:text-slate-200">
                        Resultados <span id="resultsCount" class="text-slate-400 font-normal text-sm ml-1">(0
                            encontrados)</span>
                    </h2>
                    <div class="flex items-center gap-3">
                        <button id="exportCsvBtn" onclick="exportCSV()"
                            class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-200 dark:border-slate-700 text-slate-500 hover:text-primary hover:border-primary transition-all text-xs font-bold">
                            <span class="material-symbols-outlined text-sm">download</span>
                            Exportar CSV
                        </button>
                        <div class="w-px h-4 bg-slate-200 dark:bg-slate-700"></div>
                        <span class="text-sm text-slate-500">Ordenar por:</span>
                        <select id="sortSelect"
                            class="form-select text-sm border-none bg-slate-50 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg py-1.5 pl-3 pr-8 focus:ring-0 cursor-pointer font-medium">
                            <option>Relevancia (Match)</option>
                            <option>Fecha de Publicación</option>
                            <option>Presupuesto (Mayor a Menor)</option>
                            <option>Cierre Próximo</option>
                        </select>
                    </div>
                </div>
                <!-- Scrollable Table Area -->
                <div class="flex-1 overflow-auto w-full custom-scrollbar">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 dark:bg-slate-800/50 sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[30%]">
                                    Título de la Licitación</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[15%]">
                                    Organismo / Estado</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[15%]">
                                    Presupuesto (S/)</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[15%]">
                                    Cierre de Presentación</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[10%] text-center">
                                    Match</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[10%] text-center">
                                    Estatus</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[5%] text-center">
                                    Docs</th>
                                <th
                                    class="py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[3%]">
                                </th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody" class="divide-y divide-slate-100 dark:divide-slate-700">
                            <!-- Los resultados dinámicos irán aquí -->
                        </tbody>
                    </table>

                    <!-- Skeleton Loader (visible mientras carga) -->
                    <div id="skeletonLoader" class="p-6 space-y-4">
                        <div class="skeleton h-12 w-full"></div>
                        <div class="skeleton h-12 w-full"></div>
                        <div class="skeleton h-12 w-full"></div>
                        <div class="skeleton h-12 w-3/4"></div>
                    </div>

                    <!-- ESTADO VACÍO con sugerencias -->
                    <div id="emptyState" class="hidden py-16 text-center px-8">
                        <span class="material-symbols-outlined text-6xl text-slate-200 mb-4">search_off</span>
                        <h3 class="text-lg font-bold text-slate-800 dark:text-slate-200 mb-2">No hay licitaciones con
                            estos
                            filtros</h3>
                        <p class="text-slate-500 text-sm mb-6">Intenta ajustando las palabras clave o el rango de
                            presupuesto.</p>
                        <div class="flex flex-wrap justify-center gap-2">
                            <button onclick="suggestSearch('acero')"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-primary/10 hover:text-primary text-slate-600 rounded-full text-xs font-semibold transition-all">Probar:
                                acero</button>
                            <button onclick="suggestSearch('puente')"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-primary/10 hover:text-primary text-slate-600 rounded-full text-xs font-semibold transition-all">Probar:
                                puente</button>
                            <button onclick="suggestSearch('metalmecánica')"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-primary/10 hover:text-primary text-slate-600 rounded-full text-xs font-semibold transition-all">Probar:
                                metalmecánica</button>
                            <button onclick="suggestSearch('techado')"
                                class="px-3 py-1.5 bg-slate-100 hover:bg-primary/10 hover:text-primary text-slate-600 rounded-full text-xs font-semibold transition-all">Probar:
                                techado</button>
                        </div>
                    </div>

                    <!-- Mobile Card View -->
                    <div id="mobileCards" class="mobile-cards p-4 space-y-3"></div>
                </div>

                <!-- Pagination Footer (Se ocultará si hay 0 resultados) -->
                <div id="paginationFooter"
                    class="px-6 py-4 border-t border-slate-100 dark:border-slate-700 flex items-center justify-between bg-white dark:bg-[#1e293b]">
                    <div class="text-sm text-slate-500 dark:text-slate-400">
                        Mostrando <span id="currentRange" class="font-medium text-slate-900 dark:text-white">...</span>
                        de <span id="totalResultsText" class="font-medium text-slate-900 dark:text-white">...</span>
                        resultados
                    </div>
                    <div class="flex gap-2">
                        <button
                            class="px-3 py-1 rounded border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm hover:bg-slate-50 dark:hover:bg-slate-800 disabled:opacity-50"
                            disabled="">Anterior</button>
                        <button class="px-3 py-1 rounded bg-primary text-white text-sm hover:bg-blue-600">1</button>
                        <button
                            class="px-3 py-1 rounded border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm hover:bg-slate-50 dark:hover:bg-slate-800">2</button>
                        <button
                            class="px-3 py-1 rounded border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm hover:bg-slate-50 dark:hover:bg-slate-800">3</button>
                        <span class="px-2 text-slate-400">...</span>
                        <button
                            class="px-3 py-1 rounded border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm hover:bg-slate-50 dark:hover:bg-slate-800">Siguiente</button>
                    </div>
                </div>
            </div>
        </section>
        </div> <!-- Cierre de searchView -->

        <!-- Dashboard View -->
        <div id="dashboardView"
            class="view-section hidden flex-1 overflow-y-auto bg-background-light dark:bg-background-dark p-8">
            <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight mb-8">Panel de Control</h1>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2">Oportunidades Totales</p>
                    <p id="statTotal" class="text-4xl font-black text-primary">0</p>
                </div>
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2">Presupuesto en Obras</p>
                    <p id="statBudget" class="text-4xl font-black text-green-500">S/ 0</p>
                </div>
                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2">Match Promedio</p>
                    <p id="statMatch" class="text-4xl font-black text-orange-500">0%</p>
                </div>
            </div>
            <div class="bg-primary/5 border border-primary/20 p-8 rounded-2xl mb-8">
                <h2 class="font-bold text-primary mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined">analytics</span> Inteligencia de Mercado
                </h2>
                <p class="text-sm text-slate-600 dark:text-slate-400 leading-relaxed">
                    Este mes se han detectado procesos que requieren estructuras metálicas en varias regiones del Perú.
                    Le recomendamos enfocar su búsqueda en <strong>Junín</strong> y <strong>Lima</strong>, donde se
                    concentran los mayores presupuestos.
                </p>
            </div>
            <!-- MATERIALES MÁS DEMANDADOS -->
            <div
                class="bg-white dark:bg-surface-dark p-6 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-sm">inventory_2</span> Top Materiales del Mes
                </h3>
                <div id="topMaterials" class="space-y-3">
                    <!-- Inyectado por JS -->
                </div>
            </div>
        </div>

        <!-- Analíticas View -->
        <div id="analyticsView"
            class="view-section hidden flex-1 overflow-y-auto bg-background-light dark:bg-background-dark p-8 text-center">
            <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight mb-8">Analíticas</h1>
            <div
                class="bg-white dark:bg-surface-dark p-12 rounded-2xl border border-dashed border-slate-300 dark:border-slate-700">
                <span class="material-symbols-outlined text-6xl text-slate-300 mb-4 font-light">insights</span>
                <p class="text-slate-500">Módulo de IA analizando tendencias del SEACE...</p>
            </div>
        </div>
    </main>

    <!-- PANEL LATERAL (Drawer) - Se desliza desde la derecha -->
    <div id="drawerOverlay" class="fixed inset-0 bg-black/40 z-40 hidden opacity-0 transition-opacity duration-300"
        onclick="closeDrawer()"></div>
    <aside id="drawerPanel"
        class="fixed top-0 right-0 h-full w-full md:w-[520px] bg-white dark:bg-slate-900 z-50 shadow-2xl transform translate-x-full transition-transform duration-300 ease-out overflow-y-auto">
        <!-- Drawer Header -->
        <div
            class="sticky top-0 z-10 bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span id="drawerBadge"
                    class="px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700">Abierta</span>
                <span id="drawerId" class="text-xs font-mono text-slate-400">---</span>
            </div>
            <div class="flex items-center gap-2">
                <button id="drawerFollowBtn" onclick="toggleDrawerFollow()"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-200 text-slate-500 hover:border-primary hover:text-primary transition-all text-xs font-bold">
                    <span class="material-symbols-outlined text-sm">bookmark</span> Seguir
                </button>
                <a id="drawerFullLink" href="#"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-primary text-white text-xs font-bold hover:bg-blue-600 transition-all">
                    <span class="material-symbols-outlined text-sm">open_in_new</span> Ver completo
                </a>
                <button onclick="closeDrawer()"
                    class="p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-700 transition-all">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>
        <!-- Drawer Body -->
        <div class="p-6 space-y-6">
            <div>
                <h2 id="drawerTitle" class="text-xl font-black text-slate-900 dark:text-white leading-tight mb-3">---
                </h2>
                <div class="flex flex-wrap items-center gap-3 text-xs text-slate-500">
                    <span class="flex items-center gap-1"><span
                            class="material-symbols-outlined text-sm">account_balance</span> <span id="drawerAgency"
                            class="font-bold text-slate-700">---</span></span>
                    <span class="text-slate-300">|</span>
                    <span class="flex items-center gap-1"><span
                            class="material-symbols-outlined text-sm">location_on</span> <span
                            id="drawerLocation">---</span></span>
                </div>
            </div>
            <!-- Presupuesto -->
            <div class="bg-slate-50 dark:bg-slate-800 p-5 rounded-2xl">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Presupuesto Referencial
                </p>
                <p id="drawerBudget"
                    class="text-3xl font-black text-slate-900 dark:text-white tracking-tighter tabular-nums">S/ 0</p>
                <!-- SEMÁFORO FINANCIERO -->
                <div id="drawerSemaforo" class="mt-3 flex items-center gap-2 text-xs hidden">
                    <span id="semaforoIcon" class="material-symbols-outlined text-sm">traffic</span>
                    <span id="semaforoText" class="font-bold">---</span>
                </div>
            </div>
            <!-- CALCULADORA RÁPIDA DE RENTABILIDAD -->
            <div class="bg-amber-50 border border-amber-200 p-5 rounded-2xl">
                <h4
                    class="text-[10px] font-black text-amber-600 uppercase tracking-widest mb-3 flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">calculate</span> Calculadora Rápida
                </h4>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div>
                        <label class="text-[10px] text-slate-500 font-bold block mb-1">Costo Materiales (S/)</label>
                        <input id="calcMateriales" type="number" placeholder="0" oninput="calcMargen()"
                            class="w-full text-sm py-2 px-3 rounded-lg bg-white border border-amber-200 focus:ring-1 focus:ring-amber-400 text-slate-700 tabular-nums" />
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 font-bold block mb-1">Mano de Obra (S/)</label>
                        <input id="calcManoObra" type="number" placeholder="0" oninput="calcMargen()"
                            class="w-full text-sm py-2 px-3 rounded-lg bg-white border border-amber-200 focus:ring-1 focus:ring-amber-400 text-slate-700 tabular-nums" />
                    </div>
                </div>
                <div id="calcResultado" class="text-center p-3 bg-white rounded-xl border border-amber-100">
                    <p class="text-[10px] text-slate-400 uppercase font-bold">Margen Estimado</p>
                    <p id="calcMargenText" class="text-2xl font-black text-slate-300">---</p>
                </div>
            </div>
            <!-- Descripción -->
            <div>
                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Objeto del Proceso</h4>
                <p id="drawerDesc" class="text-sm text-slate-700 dark:text-slate-300 leading-relaxed">---</p>
            </div>
            <!-- Timeline Rápido -->
            <div>
                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Cronograma</h4>
                <div id="drawerTimeline" class="space-y-3"></div>
            </div>
            <!-- Documentos -->
            <div>
                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Documentos</h4>
                <div class="space-y-2">
                    <div
                        class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-xl hover:bg-primary/5 transition-all cursor-pointer group">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-red-500">picture_as_pdf</span>
                            <div>
                                <p class="text-xs font-bold text-slate-700">Bases Administrativas</p>
                                <p class="text-[10px] text-slate-400">PDF</p>
                            </div>
                        </div>
                        <span
                            class="material-symbols-outlined text-slate-300 group-hover:text-primary text-sm">download</span>
                    </div>
                    <div
                        class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-xl hover:bg-primary/5 transition-all cursor-pointer group">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-blue-500">folder_zip</span>
                            <div>
                                <p class="text-xs font-bold text-slate-700">Expediente Técnico</p>
                                <p class="text-[10px] text-slate-400">ZIP • Planos y anexos</p>
                            </div>
                        </div>
                        <span
                            class="material-symbols-outlined text-slate-300 group-hover:text-primary text-sm">download</span>
                    </div>
                </div>
            </div>
            <!-- Requisitos -->
            <div>
                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Requisitos</h4>
                <div id="drawerRequirements" class="space-y-2"></div>
            </div>
            <!-- IA Insight -->
            <div class="bg-primary rounded-2xl p-5 text-white">
                <p class="text-[10px] font-black uppercase tracking-widest mb-2 opacity-60">IA Insights</p>
                <p class="text-sm font-semibold leading-relaxed">Proceso con <span
                        class="bg-white/20 px-1.5 py-0.5 rounded text-xs font-black">ALTA AFINIDAD</span> para
                    INPROMETAL. Calza con su especialidad en Fabricaciones Metálicas.</p>
            </div>
            <!-- BOTÓN GENERAR PRE-COTIZACIÓN -->
            <button onclick="generarPreCotizacion()"
                class="w-full py-4 bg-green-600 hover:bg-green-700 text-white rounded-2xl font-black text-sm uppercase tracking-widest flex items-center justify-center gap-2 shadow-lg shadow-green-600/20 transition-all hover:scale-[1.01]">
                <span class="material-symbols-outlined">receipt_long</span>
                Generar Pre-Cotización
            </button>
        </div>
    </aside>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Offline Banner -->
    <div id="offlineBanner"
        class="fixed bottom-0 left-0 right-0 bg-red-600 text-white text-center py-3 text-sm font-bold z-50 hidden transition-all">
        <span class="material-symbols-outlined text-sm align-middle mr-1">wifi_off</span>
        Sin conexión a internet. Los datos mostrados pueden no estar actualizados.
    </div>

    <script src="app.js"></script>
</body>

</html>